<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta property="og:title" content="Confluence recipe"><meta property="og:description" content="Steps to install / upgrade Confluence with the Atlassian bin installer on Linux."><meta property="og:type" content="article"><meta property="og:url" content="https://cgerull.github.io/techinfo/posts/confluence-recipe/"><meta property="article:published_time" content="2018-12-18T08:13:17+00:00"><meta property="article:modified_time" content="2018-12-18T08:13:17+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Confluence recipe"><meta name=twitter:description content="Steps to install / upgrade Confluence with the Atlassian bin installer on Linux."><meta name=generator content="Hugo 0.101.0"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"Confluence recipe","url":"https://cgerull.github.io/techinfo/posts/confluence-recipe/","wordCount":"245","datePublished":"2018-12-18T08:13:17+00:00","dateModified":"2018-12-18T08:13:17+00:00","author":{"@type":"Person","name":null},"keywords":"Atlassian","description":"Steps to install / upgrade Confluence with the Atlassian bin installer on Linux."}</script><link rel=canonical href=https://cgerull.github.io/techinfo/posts/confluence-recipe/><title>Confluence recipe | techinfo.gerull.nl</title><link href=https://cgerull.github.io/techinfo/css/style.beb8012edc08ba10be012f079d618dc243812267efe62e11f22fe49618f976a4.css rel=stylesheet integrity="sha256-vrgBLtwIuhC+AS8HnWGNwkOBImfv5i4R8i/klhj5dqQ=" crossorigin=anonymous><script defer src=https://cgerull.github.io/techinfo/js/fontawesome.min.f5072c55a0721857184db93a50561d7dc13975b4de2e19db7f81eb5f3fa57270.js integrity="sha256-9QcsVaByGFcYTbk6UFYdfcE5dbTeLhnbf4HrXz+lcnA=" crossorigin=anonymous></script></head><body><div class=blog-masthead><div class=container><nav class="nav blog-nav"><a class=nav-link href=https://cgerull.github.io/techinfo>Home</a></nav></div></div><header class=blog-header><div class=container><h1 class=blog-title dir=auto><a href=https://cgerull.github.io/techinfo rel=home>techinfo.gerull.nl</a></h1></div></header><div class=container><div class=row><div class="col-sm-8 blog-main"><article class=blog-post><header><h2 class=blog-post-title dir=auto><a href=https://cgerull.github.io/techinfo/posts/confluence-recipe/>Confluence recipe</a></h2><p class=blog-post-meta><time datetime=2018-12-18T08:13:17Z>Tue Dec 18, 2018</time>
in
<span class="fas fa-folder" aria-hidden=true></span>&nbsp;<a href=/categories/atlassian/ rel="category tag">Atlassian</a></p></header><p>This instructions assume that Confluence is installed in <code>/opt/confluence</code> and the data directory is <code>/var/confluence</code>. The installation is on Ubuntu Linux but should also work on other flavours of Linux. Confluence requires a supported database, in this instruction I assume that the database is already configured.</p><h2 id=preparation>Preparation</h2><ul><li><input disabled type=checkbox> upgrade / install database</li><li><input disabled type=checkbox> remove stale installers and backups</li><li><input disabled type=checkbox> check diskspace, /opt needs at least 900MB free space</li><li><input disabled type=checkbox> check if the license is valid</li><li><input disabled type=checkbox> download Confluence</li></ul><h2 id=confluence-download>Confluence download</h2><pre tabindex=0><code>#
# replace &lt;version&gt; with the required version, e.g. 6.4.3
#
cd /opt/download
sudo curl -vvkL https://www.atlassian.com/software/confluence/downloads/binary/atlassian-confluence-&lt;version&gt;-x64.bin &gt; atlassian-confluence-&lt;version&gt;-x64.bin
sudo chmod +x atlassian-confluence-&lt;version&gt;-x64.bin
</code></pre><h2 id=upgrade>Upgrade</h2><ul><li>check local admin account, reset password if necessary</li><li>stop the server</li><li>execute <code>/opt/downloads/atlassian-confluence-5.9.6-x64.bin</code></li><li>if behind a proxy then add proxy configuration to <code>/opt/confluence/bin/setenv.sh</code></li></ul><pre tabindex=0><code>CATALINA_OPTS=&#34;-Dhttp.proxyHost=&lt;http-proxy&gt; -Dhttp.proxyPort=8080 ${CATALINA_OPTS}&#34;
CATALINA_OPTS=&#34;-Dhttps.proxyHost=&lt;https-proxy&gt; -Dhttps.proxyPort=8080 ${CATALINA_OPTS}&#34;
CATALINA_OPTS=&#34;-Dhttp.nonProxyHosts=localhost\|127.0.0.1\|*.&lt;domain&gt;\|*.&lt;domain&gt;\|*.&lt;domain&gt; ${CATALINA_OPTS}&#34;
</code></pre><ul><li>When behind Apache with mod_jk, add AJP to <code>/opt/confluence/conf/server.xml</code> or uncomment if avaiable</li><li>Set permissons to <code>&lt;confluenceuser>.&lt;confluencegroup></code> for <code>/opt/confluence</code> and <code>/var/confluence</code> and their subdirectories</li><li>Start the server</li><li>View the logfile and check upgrade / startup errors (<code>tail -f /var/confluence/logs/atlassian-confluence.log</code>)</li><li>Update plugins</li><li>Run support tools -> instance health check</li></ul><h2 id=important>Important</h2><p>Add the AJS connector only after the default http connector (port 8080 or 8090) otherwise the syncrony process will break.</p><pre tabindex=0><code>&lt;Connector port=&#34;8009&#34; enableLookups=&#34;false&#34; redirectPort=&#34;8443&#34; protocol=&#34;AJP/1.3&#34; URIEncoding=&#34;UTF-8&#34;/&gt;
</code></pre><h2 id=crowd-connection>Crowd connection</h2><p>If the connection with crowd is broken you will see connection errors in the log</p><p>To re-configure the connection follow these steps:</p><ol><li>login as local admin</li><li>test, and if necessary reconfigure, crowd</li><li>sync crowd</li><li>login as LDAP user</li></ol><hr><footer><section><h4>Share</h4><nav class="nav sharing-icons"><a class=nav-item href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fcgerull.github.io%2ftechinfo%2fposts%2fconfluence-recipe%2f" title="Share on Facebook"><span class="fab fa-facebook-f fa-2x" aria-hidden=true></span></a>
<a class=nav-item href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fcgerull.github.io%2ftechinfo%2fposts%2fconfluence-recipe%2f" title="Share on LinkedIn"><span class="fab fa-linkedin-in fa-2x" aria-hidden=true></span></a>
<a class=nav-item href="https://twitter.com/intent/tweet?url=https%3a%2f%2fcgerull.github.io%2ftechinfo%2fposts%2fconfluence-recipe%2f&text=Confluence%20recipe" title="Tweet this"><span class="fab fa-twitter fa-2x"></span></a></nav></section></footer></article></div><aside class="col-sm-3 ml-auto blog-sidebar"></aside></div></div><footer class=blog-footer><p dir=auto>Blog template created by <a href=https://twitter.com/mdo>@mdo</a>, ported to Hugo by <a href=https://twitter.com/mralanorth>@mralanorth</a>.</p><p><a href=#>Back to top</a></p></footer></body></html>