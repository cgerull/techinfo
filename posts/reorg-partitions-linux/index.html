<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Reorganize physical volumes</title><style>html body{font-family:'',sans-serif;background-color:#fff}:root{--accent:brown;--border-width:5px}</style><link rel=stylesheet href=https://techinfo.gerull.nl/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family="><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/zsh.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script>$(document).on("click",function(){$(".collapse").collapse("hide")})</script><meta name=generator content="Hugo 0.111.3"><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Reorganize physical volumes</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/posts/>Home</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul></div></div></nav><main><div><h2>Reorganize physical volumes</h2><h5>A guide to reorganize Linux LVM disks.</h5><a href=https://techinfo.gerull.nltags/linux><kbd class=item-tag>linux</kbd></a>
<a href=https://techinfo.gerull.nltags/lvm><kbd class=item-tag>lvm</kbd></a>
<a href=https://techinfo.gerull.nltags/partitions><kbd class=item-tag>partitions</kbd></a></div><div align=start class=content><p>These description is written for Ubuntu Linux. With a bit of creativity it should also work for other Linux flavours.</p><blockquote><p>For all resize operations it is mandatory to stop running applications. Most reduce operations expect unmounted filesystems too.</p></blockquote><h2 id=free-or-rearrange-physical-volumes>Free or rearrange physical volumes</h2><p>Suppose you have a cluttered (physical) disklayout, i.e a number of small disk added over the course of time to extend the logical volume. Sometimes it&rsquo;s convenient to consolidated the small (virtual-) disk into a large one.</p><p>The general idea is to add one temporary large virtual disk that can contain all other volumes, move the the physical volumes to the temporary volume. Then delete the small partition and create a sufficiently large one. Eventually reserve extra space for expansion in the near future. Once the volume is created move the physical volume from temporary to the newly created one.</p><ol><li>Make sure you have a volume with enough free space to contain the emptied volume(s), i.e. add a temporary disk to the VM.</li><li><code>pvmove &lt;source device> &lt;destination temporary device></code></li><li><code>vgreduce &lt;volumegroup> &lt;physical device></code></li><li><code>pvremove &lt;physical device></code></li><li>Consolidate the old partitions and create one LVM partion</li><li><code>pvcreate &lt;physical device from step 5></code></li><li><code>vgextend &lt;volumegroup> &lt;physical device></code></li><li><code>pvmove &lt;source temporary device> &lt;destination device></code></li><li><code>vgreduce &lt;volumegroup> &lt;temporary device></code></li><li><code>pvremove &lt;temporary device></code></li><li>Remove temporay volume from VM.</li></ol><p>As the description of the steps above are very elementary, here is an step-by-step example of a <a href=/pages/reorg-example/>space consolidation</a>.</p><h2 id=resize-physical-partition>Resize physical partition</h2><ol><li>Stop applications</li><li>umount filesystem(s)</li><li><code>pvresize --setphysicalvolumesize &lt;newsize>GB /dev/&lt;physical volume></code></li><li>parted → resizepart → <code>&lt;partnumber></code> → End</li></ol></div></main><footer><p class="copyright text-muted">© 2022 C. Gerull All rights reserved.</p></footer></body></html>