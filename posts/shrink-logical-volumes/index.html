<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Shrink logic volumes</title><style>html body{font-family:'',sans-serif;background-color:#fff}:root{--accent:brown;--border-width:5px}</style><link rel=stylesheet href=https://techinfo.gerull.nl/css/main.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family="><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/solarized-dark.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/go.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/python.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/zsh.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js></script>
<script src=https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js integrity=sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa crossorigin=anonymous></script>
<script>$(document).on("click",function(){$(".collapse").collapse("hide")})</script><meta name=generator content="Hugo 0.101.0"><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></head><body><nav class="navbar navbar-default navbar-fixed-top"><div class=container><div class=navbar-header><a class="navbar-brand visible-xs" href=#>Shrink logic volumes</a>
<button class=navbar-toggle data-target=.navbar-collapse data-toggle=collapse>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="collapse navbar-collapse"><ul class="nav navbar-nav"><li><a href=/posts/>Home</a></li><li><a href=/tags/>Tags</a></li><li><a href=/about/>About</a></li></ul></div></div></nav><main><div><h2>Shrink logic volumes</h2><h5>Use LVM2 to shrink volumes on the fly.</h5><a href=https://techinfo.gerull.nltags/file-system><kbd class=item-tag>file system</kbd></a>
<a href=https://techinfo.gerull.nltags/install><kbd class=item-tag>install</kbd></a>
<a href=https://techinfo.gerull.nltags/linux><kbd class=item-tag>linux</kbd></a>
<a href=https://techinfo.gerull.nltags/lvm><kbd class=item-tag>lvm</kbd></a></div><div align=start class=content><p>In this post I will point out the steps to shrink logic volumes.</p><p>The order of shrinking is just the reverse of expanding:</p><ul><li>un-mount the file system</li><li>check file system integrity</li><li>shrink file system</li><li>shrink logic volume.</li></ul><blockquote><p><strong>Before you start make sure you have recent backup of the disk.</strong></p></blockquote><h2 id=the-steps-in-detail>The steps in detail</h2><p>1. First un-mount the file system to make sure no one has access anymore. For some file systems you must switch to single user mode for this. Then check the file system integrity.</p><ul><li>if /yyy is the mount point <code>sudo umount /yyy</code></li><li>As this is a logical volume, vg-xxx is the volume group and yyy is the symbolic name of the lv. <code>sudo e2fsck -f /dev/mapper/vg-xxx/yyy</code></li></ul><p>2. Shrink the file system to some point
<code>sudo resize2fs /dev/mapper/vg-xxx/yyy 2000M</code>
Here it goes down to 2G, but <strong>above</strong> the physical size of existing files. This command works for both ext2 and ext3.</p><p>3. Shrink the logic volume
<code>sudo lvresize -L -1G /dev/mapper/vg-xxx/yyy</code>
Here the logic volume is shrunk by 1G. Don&rsquo;t shrink beyond your file system size, the consequences are disastrous. Do the math. <em>And take it very serious!</em></p><p>4. Expand the file system to fit the shrunk logic volume
<code>sudo resize2fs -p /dev/mapper/vg-xxx/yyy</code></p><p>5. Remount the file system.</p></div></main><footer><p class="copyright text-muted">Â© 2022 C. Gerull All rights reserved.</p></footer></body></html>